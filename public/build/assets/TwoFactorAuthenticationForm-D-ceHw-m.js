import{b as v,x as z,r as y,d as r,o,g as n,a,y as D,w as s,t as $,n as w,s as H,f as m,q as I,Q as G,T as O,m as W,z as j,c as b,e as c,u as F,F as J,h as X,N as R}from"./app-BEcxhe1F.js";import{_ as N}from"./InputError-CpVMfFDh.js";import{_ as q}from"./TextInput-DaBpTrN_.js";import{_ as Z}from"./InputLabel-DJT1qPlu.js";const ee={class:"text-muted fs-14 mb-3"},te={class:"mb-3"},oe={class:"text-end"},C={__name:"ConfirmsPassword",props:{title:{type:String,default:"Confirm Password"},content:{type:String,default:"For your security, please confirm your password to continue."},button:{type:String,default:"Confirm"}},emits:["confirmed"],setup(k,{emit:V}){const B=V,u=v(!1),e=z({password:"",error:"",processing:!1}),d=v(null),h=()=>{axios.get(route("password.confirmation")).then(l=>{l.data.confirmed?B("confirmed"):(console.log(l),u.value=!0,setTimeout(()=>d.value.focus(),250))})},_=()=>{e.processing=!0,axios.post(route("password.confirm"),{password:e.password}).then(()=>{e.processing=!1,f(),I().then(()=>B("confirmed"))}).catch(l=>{e.processing=!1,e.error=l.response.data.errors.password[0],d.value.focus()})},f=()=>{u.value=!1,e.password="",e.error=""};return(l,i)=>{const T=y("BButton"),A=y("BModal");return o(),r("span",null,[n("span",{onClick:h},[D(l.$slots,"default")]),a(A,{modelValue:u.value,"onUpdate:modelValue":i[1]||(i[1]=x=>u.value=x),title:k.title,"hide-footer":"","header-class":"bg-success-subtle p-3"},{default:s(()=>[n("p",ee,$(k.content),1),n("div",te,[a(q,{ref_key:"passwordInput",ref:d,modelValue:e.password,"onUpdate:modelValue":i[0]||(i[0]=x=>e.password=x),type:"password",placeholder:"Password",autocomplete:"current-password",onKeyup:H(_,["enter"]),class:w({"is-invalid":e.error})},null,8,["modelValue","class"]),a(N,{message:e.error,class:"mt-2"},null,8,["message"])]),n("div",oe,[a(T,{variant:"danger",onClick:f},{default:s(()=>i[2]||(i[2]=[m("Cancel")])),_:1,__:[2]}),a(T,{variant:"success",class:w(["ms-1",{"opacity-25":e.processing}]),disabled:e.processing,onClick:_},{default:s(()=>[m($(k.button),1)]),_:1},8,["class","disabled"])])]),_:1},8,["modelValue","title"])])}}},se={key:0},ae={key:1},ne={key:2},re={key:3},le={key:0},ie={class:"mt-3 max-w-xl text-sm text-gray-600"},ue={key:0,class:"text-muted"},de={key:1},ce=["innerHTML"],me={key:0,class:"mt-3 text-muted"},pe={class:"fw-semibold"},fe=["innerHTML"],ve={key:1,class:"mt-3"},_e={key:1},ye={class:"fw-semibold"},we={class:"language-markup"},he={class:"mt-3"},ge={key:0},be={key:1},Te={__name:"TwoFactorAuthenticationForm",props:{requiresConfirmation:Boolean},setup(k){const V=k,B=G(),u=v(!1),e=v(!1),d=v(!1),h=v(null),_=v(null),f=v([]),l=O({code:""}),i=W(()=>{var p;return!u.value&&((p=B.props.auth.user)==null?void 0:p.two_factor_enabled)});j(i,()=>{i.value||(l.reset(),l.clearErrors())});const T=()=>{u.value=!0,R.post(route("two-factor.enable"),{},{preserveScroll:!0,onSuccess:()=>Promise.all([A(),x(),P()]),onFinish:()=>{u.value=!1,e.value=V.requiresConfirmation}})},A=()=>axios.get(route("two-factor.qr-code")).then(p=>{h.value=p.data.svg}),x=()=>axios.get(route("two-factor.secret-key")).then(p=>{_.value=p.data.secretKey}),P=()=>axios.get(route("two-factor.recovery-codes")).then(p=>{f.value=p.data}),K=()=>{l.post(route("two-factor.confirm"),{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{e.value=!1,h.value=null,_.value=null}})},L=()=>{axios.post(route("two-factor.recovery-codes")).then(()=>P())},M=()=>{d.value=!0,R.delete(route("two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{d.value=!1,e.value=!1}})};return(p,t)=>{const E=y("BCardTitle"),Q=y("BCardHeader"),g=y("BButton"),U=y("BCardBody"),Y=y("BCard");return o(),b(Y,{"no-body":""},{default:s(()=>[a(Q,null,{default:s(()=>[a(E,null,{default:s(()=>t[1]||(t[1]=[m("Two Factor Authentication")])),_:1,__:[1]}),t[2]||(t[2]=n("p",{class:"text-muted mb-0"},"Add additional security to your account using two factor authentication.",-1))]),_:1,__:[2]}),a(U,{class:"p-4"},{default:s(()=>[i.value&&!e.value?(o(),r("h5",se," You have enabled two factor authentication. ")):i.value&&e.value?(o(),r("h5",ae," Finish enabling two factor authentication. ")):(o(),r("h5",ne," You have not enabled two factor authentication. ")),t[11]||(t[11]=n("div",{class:"mt-3 text-muted text-sm"},[n("p",null," When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application. ")],-1)),i.value?(o(),r("div",re,[h.value?(o(),r("div",le,[n("div",ie,[e.value?(o(),r("p",ue," To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code. ")):(o(),r("p",de," Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key. "))]),n("div",{class:"mt-3 p-2",innerHTML:h.value},null,8,ce),_.value?(o(),r("div",me,[n("p",pe,[t[3]||(t[3]=m(" Setup Key: ")),n("span",{innerHTML:_.value},null,8,fe)])])):c("",!0),e.value?(o(),r("div",ve,[a(Z,{for:"code",value:"Code"}),a(q,{id:"code",modelValue:F(l).code,"onUpdate:modelValue":t[0]||(t[0]=S=>F(l).code=S),type:"text",name:"code",inputmode:"numeric",autofocus:"",autocomplete:"one-time-code",onKeyup:H(K,["enter"]),class:w({"is-invalid":F(l).errors.code})},null,8,["modelValue","class"]),a(N,{message:F(l).errors.code,class:"mt-2"},null,8,["message"])])):c("",!0)])):c("",!0),f.value.length>0&&!e.value?(o(),r("div",_e,[t[4]||(t[4]=n("div",{class:"mt-3 text-sm text-muted"},[n("p",{class:"fw-semibold"}," Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost. ")],-1)),n("div",ye,[n("pre",we,[n("code",null,[(o(!0),r(J,null,X(f.value,S=>(o(),r("div",{key:S},$(S),1))),128))])])])])):c("",!0)])):c("",!0),n("div",he,[i.value?(o(),r("div",be,[a(C,{onConfirmed:K},{default:s(()=>[e.value?(o(),b(g,{key:0,variant:"success",type:"button",class:w(["me-1",{"opacity-25":u.value}]),disabled:u.value},{default:s(()=>t[6]||(t[6]=[m("Confirm")])),_:1,__:[6]},8,["class","disabled"])):c("",!0)]),_:1}),a(C,{onConfirmed:L},{default:s(()=>[f.value.length>0&&!e.value?(o(),b(g,{key:0,variant:"success",type:"button",class:"me-1"},{default:s(()=>t[7]||(t[7]=[m("Regenerate Recovery Codes")])),_:1,__:[7]})):c("",!0)]),_:1}),a(C,{onConfirmed:P},{default:s(()=>[f.value.length===0&&!e.value?(o(),b(g,{key:0,variant:"success",class:"me-1",type:"button"},{default:s(()=>t[8]||(t[8]=[m("Show Recovery Codes")])),_:1,__:[8]})):c("",!0)]),_:1}),a(C,{onConfirmed:M},{default:s(()=>[e.value?(o(),b(g,{key:0,variant:"danger",type:"button",class:w({"opacity-25":d.value}),disabled:d.value},{default:s(()=>t[9]||(t[9]=[m("Cancel")])),_:1,__:[9]},8,["class","disabled"])):c("",!0)]),_:1}),a(C,{onConfirmed:M},{default:s(()=>[e.value?c("",!0):(o(),b(g,{key:0,variant:"danger",type:"button",class:w({"opacity-25":d.value}),disabled:d.value},{default:s(()=>t[10]||(t[10]=[m("Disable")])),_:1,__:[10]},8,["class","disabled"]))]),_:1})])):(o(),r("div",ge,[a(C,{onConfirmed:T},{default:s(()=>[a(g,{variant:"danger w-100",type:"button",class:w({"opacity-25":u.value}),disabled:u.value},{default:s(()=>t[5]||(t[5]=[m("Enable")])),_:1,__:[5]},8,["class","disabled"])]),_:1})]))])]),_:1,__:[11]})]),_:1})}}};export{Te as default};
